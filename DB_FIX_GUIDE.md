# ðŸ¥ Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐµ Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

## ðŸš¨ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°

ÐÐ° ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð°Ñ… Ð²Ð¸Ð´Ð½Ñ‹ Ð¿Ñ€Ð¸Ð·Ð½Ð°ÐºÐ¸ Ð¿Ð¾Ð²Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…:
- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ 2720% (136/5 ÑÐ»Ð¾Ñ‚Ð¾Ð²)
- API Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ°Ð»ÑŒÑÐ½Ñ‹, Ñ…Ð¾Ñ‚Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ 136 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
- ÐŸÐ¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ 100% Ð¸ 5/5 ÑÐ»Ð¾Ñ‚Ð¾Ð²

## ðŸ” ÐÐ¾Ð²Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸

### 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ Ð‘Ð”

**Endpoint:** `GET /api/db-health-check?admin_tg_id=937011437`

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚:**
- âœ… Ð’ÑÐµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ñ Ð°ÐºÑ†Ð¸ÐµÐ¹ "5+1 ÐºÐ°Ð»ÑŒÑÐ½"
- âœ… Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ progress Ð¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸
- âœ… ÐŸÐµÑ€ÐµÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ progress (>100%)
- âœ… Ð—Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ñ‚Ð¸Ð¿Ð°Ð¼Ð¸
- âœ… ÐŸÑƒÑÑ‚Ð°Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ñ€Ð¸ progress > 0

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
```json
{
  "summary": {
    "totalUsers": 50,
    "usersWithIssues": 5,
    "healthyUsers": 45,
    "issueTypes": {
      "progressMismatch": 3,
      "progressOverflow": 1,
      "noRegularHookahs": 1,
      "invalidTypes": 0
    }
  },
  "issues": [
    {
      "name": "ÐÐ¸ÐºÐ¾Ð»Ð°Ð¹ Ð¨Ð°Ð´Ð¾Ð²ÑÐºÐ¸Ð¹",
      "phone": "+79270036642",
      "stock": { "progress": 2720 },
      "history": { "regular": 136, "free": 0 },
      "expected": { "progress": 100 },
      "issue": "Progress mismatch: 2720% vs expected 100%"
    }
  ]
}
```

### 2. Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

**Endpoint:** `GET /api/diagnose-user?phone=6642`

**Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:**
- Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ðµ
- Ð Ð°Ð·Ð±Ð¸Ð²ÐºÑƒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ (regular/free/other)
- ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ vs Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ progress
- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 10 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸
- Ð¢Ð¾Ñ‡Ð½ÑƒÑŽ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

### 3. ÐœÐ°ÑÑÐ¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

**Endpoint:** `POST /api/fix-all-users`

**Body:**
```json
{
  "admin_tg_id": 937011437,
  "dry_run": true  // false Ð´Ð»Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
}
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ progress Ð¸Ð· Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸
- Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ
- Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ promotion_completed ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾

**DRY RUN (dry_run: true):**
- Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‡Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾
- ÐÐ• Ð²Ð½Ð¾ÑÐ¸Ñ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð‘Ð”
- Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸

**REAL FIX (dry_run: false):**
- Ð ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð²ÑÐµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹
- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ progress Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ

## ðŸ”§ ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

### Ð¨Ð°Ð³ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ Ð‘Ð”

```bash
curl https://frontend-delta-sandy-58.vercel.app/api/db-health-check?admin_tg_id=937011437
```

Ð­Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹.

### Ð¨Ð°Ð³ 2: Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹

Ð”Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ:
```bash
curl https://frontend-delta-sandy-58.vercel.app/api/diagnose-user?phone=6642
```

### Ð¨Ð°Ð³ 3: ÐŸÑ€Ð¾Ð±Ð½Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ (DRY RUN)

```bash
curl -X POST https://frontend-delta-sandy-58.vercel.app/api/fix-all-users \
  -H "Content-Type: application/json" \
  -d '{"admin_tg_id": 937011437, "dry_run": true}'
```

ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ - Ñ‡Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾.

### Ð¨Ð°Ð³ 4: Ð ÐµÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

Ð•ÑÐ»Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ dry run Ð²Ñ‹Ð³Ð»ÑÐ´Ð¸Ñ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾:

```bash
curl -X POST https://frontend-delta-sandy-58.vercel.app/api/fix-all-users \
  -H "Content-Type: application/json" \
  -d '{"admin_tg_id": 937011437, "dry_run": false}'
```

### Ð¨Ð°Ð³ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°

Ð¡Ð½Ð¾Ð²Ð° Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ health check:
```bash
curl https://frontend-delta-sandy-58.vercel.app/api/db-health-check?admin_tg_id=937011437
```

Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ 0 Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.

## ðŸŽ¯ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸:

### ÐŸÑ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ ÐºÐ°Ð»ÑŒÑÐ½Ð° (`/api/remove-hookah`):
1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ€ÐµÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
2. Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ progress
3. Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ â†’ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
4. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ

### ÐŸÑ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ ÐºÐ°Ð»ÑŒÑÐ½Ð° (`/api/add-hookah`):
1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
2. Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ progress Ð¿ÐµÑ€ÐµÐ´ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼
3. Ð‘Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐµÑÐ»Ð¸ Ð°ÐºÑ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° (>= 100%)
4. Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ°Ð»ÑŒÑÐ½

### ÐŸÑ€Ð¸ Ð¿Ð¾Ð¸ÑÐºÐµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (`/api/search-user`):
1. ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¸Ð· Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸
2. Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ñ„Ð»Ð°Ð³ mismatch ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
3. Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

## ðŸ“Š Ð§Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ 6642:

**Ð”Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:**
- Progress: 2720%
- ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ð»Ð¾: 136/5 ÑÐ»Ð¾Ñ‚Ð¾Ð²
- ÐÐµÐ»ÑŒÐ·Ñ Ð±Ñ‹Ð»Ð¾ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:**
- ÐšÑ‚Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð» Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ°Ð»ÑŒÑÐ½Ñ‹ Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð°ÐºÑ†Ð¸Ð¸
- Progress Ñ€Ð¾Ñ Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾

**ÐŸÐ¾ÑÐ»Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:**
- Progress: 100% (Ð¼Ð°ÐºÑ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ)
- ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚: 5/5 ÑÐ»Ð¾Ñ‚Ð¾Ð²
- ÐÐºÑ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°
- Ð”Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ ÐºÐ°Ð»ÑŒÑÐ½

## ðŸ›¡ï¸ Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼

### 1. Progress Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ñ‚ 100%
```typescript
const correctProgress = Math.min(100, regularCount * 20)
```

### 2. ÐÐµÐ»ÑŒÐ·Ñ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ°Ð»ÑŒÑÐ½ ÐµÑÐ»Ð¸ Ð°ÐºÑ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°
```typescript
if (currentSlot >= 5 && stock.progress >= 100) {
  return error // Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ°
}
```

### 3. Progress Ð²ÑÐµÐ³Ð´Ð° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ ÐšÐÐ–Ð”ÐžÐ™ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ
- Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ - Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð¸ÑÑ‚Ð¸Ð½Ñ‹

### 4. Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
- Ð’ÑÐµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ
- ÐœÐ¾Ð¶Ð½Ð¾ Ð¾Ñ‚ÑÐ»ÐµÐ´Ð¸Ñ‚ÑŒ ÐºÐ¾Ð³Ð´Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°
- Ð›ÐµÐ³ÐºÐ¾ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ

## ðŸ”„ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

### Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ Ð‘Ð”:
Ð—Ð°Ð¿ÑƒÑÐºÐ°Ð¹Ñ‚Ðµ Ñ€Ð°Ð· Ð² Ð½ÐµÐ´ÐµÐ»ÑŽ:
```bash
curl https://your-domain.vercel.app/api/db-health-check?admin_tg_id=XXX
```

### ÐŸÑ€Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼:
1. Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° DRY RUN
2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾
3. Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ñ‚Ð¾Ð¼ real fix

### ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³:
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð»Ð¾Ð³Ð¸ Vercel Ð½Ð° Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ
- Ð˜Ñ‰Ð¸Ñ‚Ðµ "MISMATCH" Ð² Ð»Ð¾Ð³Ð°Ñ…
- ÐžÐ±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚Ðµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð½Ð° overflow

## ðŸ“ API Reference

### GET /api/db-health-check
- **Params:** `admin_tg_id` (required)
- **Returns:** Summary of all issues
- **Safe:** Yes, read-only

### GET /api/diagnose-user
- **Params:** `phone` (4 digits) OR `tg_id`
- **Returns:** Detailed user diagnosis
- **Safe:** Yes, read-only

### POST /api/fix-all-users
- **Body:** `{ admin_tg_id, dry_run }`
- **Returns:** List of fixes applied
- **Safe:** Only if dry_run=true

### POST /api/fix-user-progress
- **Body:** `{ user_tg_id, admin_tg_id }`
- **Returns:** Single user fix result
- **Safe:** No, modifies data

### POST /api/remove-hookah
- **Auto-fixes:** Yes, before removal
- **Safe:** Yes, with validation

### POST /api/add-hookah
- **Auto-fixes:** Yes, before adding
- **Safe:** Yes, blocks if >= 100%

