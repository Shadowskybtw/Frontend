#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º

BOT_DIR="/Users/nikolajmisin/Documents/WebApp/next-app"
BOT_SCRIPT="bot.py"
LOG_FILE="$BOT_DIR/bot.log"

cd "$BOT_DIR"

echo "ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ DUNGEON Hookah..."
echo "üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $BOT_DIR"
echo "üìù –õ–æ–≥ —Ñ–∞–π–ª: $LOG_FILE"
echo ""

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
while true; do
    echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ $(date '+%Y-%m-%d %H:%M:%S')" | tee -a "$LOG_FILE"
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    python3 "$BOT_SCRIPT" 2>&1 | tee -a "$LOG_FILE"
    
    EXIT_CODE=$?
    echo "‚ö†Ô∏è  –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –∫–æ–¥–æ–º $EXIT_CODE –≤ $(date '+%Y-%m-%d %H:%M:%S')" | tee -a "$LOG_FILE"
    
    # –ï—Å–ª–∏ –±–æ—Ç —É–ø–∞–ª, –∂–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
    if [ $EXIT_CODE -ne 0 ]; then
        echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥..." | tee -a "$LOG_FILE"
        sleep 5
    else
        # –ï—Å–ª–∏ –±–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∂–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã
        echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã..." | tee -a "$LOG_FILE"
        sleep 2
    fi
    
    echo "" | tee -a "$LOG_FILE"
done

